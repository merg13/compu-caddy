import{c as V,r as _,j as e,T as ye,X as be}from"./index-XODFVYDb.js";import{C as X}from"./camera-8C9goHzh.js";import{S as ve}from"./save-DZWpcdgn.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ie=V("arrow-left",we);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],je=V("arrow-right",Ne);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],ke=V("check",Se);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Le=V("circle-check-big",Ee);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Re=V("loader-circle",Ce);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],_e=V("play",Ie);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],re=V("rotate-ccw",Pe),$e=({onProceed:c})=>{const[o,i]=_.useState(null),[n,s]=_.useState(null),l=_.useRef(null),h=_.useRef(null),p=w=>{var j;const E=(j=w.target.files)==null?void 0:j[0];E&&i(E)},g=w=>{var j;const E=(j=w.target.files)==null?void 0:j[0];E&&s(E)},S=()=>{i(null),l.current&&(l.current.value="")},k=()=>{s(null),h.current&&(h.current.value="")},x=o&&n;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Capture Scorecard Photos"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Front Side"}),o?e.jsxs("div",{className:"space-y-4",children:[e.jsx("img",{src:URL.createObjectURL(o),alt:"Front scorecard",className:"w-full h-48 object-cover rounded-lg"}),e.jsxs("button",{onClick:S,className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 flex items-center justify-center gap-2",children:[e.jsx(re,{size:20}),"Retake"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-full h-48 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx(X,{size:48,className:"text-gray-400"})}),e.jsx("input",{ref:l,type:"file",accept:"image/*",capture:"environment",onChange:p,className:"hidden",id:"front-photo"}),e.jsxs("label",{htmlFor:"front-photo",className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center justify-center gap-2 cursor-pointer",children:[e.jsx(X,{size:20}),"Capture Front"]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Back Side"}),n?e.jsxs("div",{className:"space-y-4",children:[e.jsx("img",{src:URL.createObjectURL(n),alt:"Back scorecard",className:"w-full h-48 object-cover rounded-lg"}),e.jsxs("button",{onClick:k,className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 flex items-center justify-center gap-2",children:[e.jsx(re,{size:20}),"Retake"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-full h-48 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx(X,{size:48,className:"text-gray-400"})}),e.jsx("input",{ref:h,type:"file",accept:"image/*",capture:"environment",onChange:g,className:"hidden",id:"back-photo"}),e.jsxs("label",{htmlFor:"back-photo",className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center justify-center gap-2 cursor-pointer",children:[e.jsx(X,{size:20}),"Capture Back"]})]})]})]}),x&&e.jsxs("button",{onClick:()=>c(o,n),className:"w-full px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center justify-center gap-2",children:[e.jsx(je,{size:20}),"Proceed to Next Step"]})]})},Oe=({extractedCourseMetadata:c,extractedRoundData:o,onSave:i,onCancel:n})=>{const[s,l]=_.useState(null),[h,p]=_.useState([]),[g,S]=_.useState({});_.useEffect(()=>{c&&l({...c}),o&&p([...o])},[c,o]);const k=(d,u)=>{s&&(l({...s,[d]:u}),g[d]&&S(b=>({...b,[d]:""})))},x=(d,u,b)=>{if(!s)return;const L=[...s.holeDetails];L[d]={...L[d],[u]:b},l({...s,holeDetails:L})},w=(d,u,b)=>{const L=[...h];L[d]={...L[d],[u]:b},p(L)},E=d=>d>=.8?"text-green-600":d>=.6?"text-yellow-600":"text-red-600",j=d=>d>=.8?e.jsx(ke,{size:16,className:"text-green-600"}):d>=.6?e.jsx(ye,{size:16,className:"text-yellow-600"}):e.jsx(be,{size:16,className:"text-red-600"}),P=()=>{var u;const d={};return(u=s==null?void 0:s.courseName)!=null&&u.trim()||(d.courseName="Course name is required"),s!=null&&s.holeDetails&&s.holeDetails.forEach((b,L)=>{(!b.par||b.par<3||b.par>5)&&(d[`hole-${L}-par`]="Par must be 3-5")}),h.length>0&&h.forEach((b,L)=>{b.score!==null&&(b.score<1||b.score>15)&&(d[`score-${L}`]="Score must be 1-15"),b.putts!==null&&b.putts!==void 0&&(b.putts<0||b.putts>10)&&(d[`putts-${L}`]="Putts must be 0-10")}),S(d),Object.keys(d).length===0},$=()=>{var b,L,A,W;if(!P()||!s)return;const d={id:`course-${Date.now()}`,name:s.courseName,location:{address:s.location,city:(L=(b=s.location)==null?void 0:b.split(",")[0])==null?void 0:L.trim(),state:(W=(A=s.location)==null?void 0:A.split(",")[1])==null?void 0:W.trim()},holes:s.holeDetails.map(R=>({number:R.holeNumber,par:R.par,handicap:R.handicap||1,yardages:R.distance?{regular:R.distance}:{}})),par:s.totalPar,confidence:s.confidence};let u;h.length>0&&(u={courseId:d.id,date:new Date().toISOString().split("T")[0],teeBox:"Regular",holeScores:h.filter(R=>R.score!==null).map(R=>({holeNumber:R.holeNumber,score:R.score,putts:R.putts||void 0,fairwayHit:void 0,greenInRegulation:void 0,penaltyStrokes:0})),confidence:h.reduce((R,H)=>R+H.confidence,0)/h.length}),i(d,u)};return s?e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800",children:"Review Extracted Data"}),e.jsxs("div",{className:"flex items-center gap-2",children:[j(s.confidence),e.jsxs("span",{className:`text-sm font-medium ${E(s.confidence)}`,children:[Math.round(s.confidence*100),"% confidence"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-6",children:"Course Information"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Course Name *"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:s.courseName,onChange:d=>k("courseName",d.target.value),className:`flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${g.courseName?"border-red-500":"border-gray-300"}`,placeholder:"Enter course name"}),j(s.confidence)]}),g.courseName&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:g.courseName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Location"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:s.location||"",onChange:d=>k("location",d.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"City, State"}),j(s.confidence)]})]})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("h4",{className:"text-lg font-medium mb-4",children:"Hole Details"}),e.jsxs("table",{className:"min-w-full table-auto border-collapse border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-left",children:"Hole"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-left",children:"Par *"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-left",children:"Yardage"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-left",children:"Handicap"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-left",children:"Confidence"})]})}),e.jsx("tbody",{children:s.holeDetails.map((d,u)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-medium",children:d.holeNumber}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2",children:[e.jsx("input",{type:"number",value:d.par,onChange:b=>x(u,"par",parseInt(b.target.value)||0),className:`w-16 px-2 py-1 border rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent ${g[`hole-${u}-par`]?"border-red-500":"border-gray-300"}`,min:"3",max:"5"}),g[`hole-${u}-par`]&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:g[`hole-${u}-par`]})]}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:e.jsx("input",{type:"number",value:d.distance||"",onChange:b=>x(u,"distance",parseInt(b.target.value)||void 0),className:"w-20 px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"yards"})}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:e.jsx("input",{type:"number",value:d.handicap||"",onChange:b=>x(u,"handicap",parseInt(b.target.value)||void 0),className:"w-16 px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"1",max:"18"})}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-1",children:[j(s.confidence),e.jsxs("span",{className:`text-sm ${E(s.confidence)}`,children:[Math.round(s.confidence*100),"%"]})]})})]},d.holeNumber))})]})]}),e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:["Total Par: ",e.jsx("span",{className:"font-medium",children:s.totalPar})]})]}),h.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-6",children:"Round Scores"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto border-collapse border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-left",children:"Hole"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-left",children:"Score"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-left",children:"Putts"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-left",children:"Confidence"})]})}),e.jsx("tbody",{children:h.map((d,u)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-medium",children:d.holeNumber}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2",children:[e.jsx("input",{type:"number",value:d.score||"",onChange:b=>w(u,"score",parseInt(b.target.value)||null),className:`w-16 px-2 py-1 border rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent ${g[`score-${u}`]?"border-red-500":"border-gray-300"}`,min:"1",max:"15"}),g[`score-${u}`]&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:g[`score-${u}`]})]}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2",children:[e.jsx("input",{type:"number",value:d.putts||"",onChange:b=>w(u,"putts",parseInt(b.target.value)||null),className:`w-16 px-2 py-1 border rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent ${g[`putts-${u}`]?"border-red-500":"border-gray-300"}`,min:"0",max:"10"}),g[`putts-${u}`]&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:g[`putts-${u}`]})]}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-1",children:[j(d.confidence),e.jsxs("span",{className:`text-sm ${E(d.confidence)}`,children:[Math.round(d.confidence*100),"%"]})]})})]},d.holeNumber))})]})})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:n,className:"px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 text-gray-700 font-medium",children:"Cancel"}),e.jsxs("button",{onClick:$,className:"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium flex items-center gap-2",children:[e.jsx(ve,{size:20}),"Save Data"]})]})]}):e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"text-gray-500",children:"No course data to review"})})};var Te={exports:{}};(function(c){var o=function(i){var n=Object.prototype,s=n.hasOwnProperty,l=Object.defineProperty||function(r,t,a){r[t]=a.value},h,p=typeof Symbol=="function"?Symbol:{},g=p.iterator||"@@iterator",S=p.asyncIterator||"@@asyncIterator",k=p.toStringTag||"@@toStringTag";function x(r,t,a){return Object.defineProperty(r,t,{value:a,enumerable:!0,configurable:!0,writable:!0}),r[t]}try{x({},"")}catch{x=function(t,a,m){return t[a]=m}}function w(r,t,a,m){var f=t&&t.prototype instanceof b?t:b,N=Object.create(f.prototype),T=new D(m||[]);return l(N,"_invoke",{value:M(r,a,T)}),N}i.wrap=w;function E(r,t,a){try{return{type:"normal",arg:r.call(t,a)}}catch(m){return{type:"throw",arg:m}}}var j="suspendedStart",P="suspendedYield",$="executing",d="completed",u={};function b(){}function L(){}function A(){}var W={};x(W,g,function(){return this});var R=Object.getPrototypeOf,H=R&&R(R(y([])));H&&H!==n&&s.call(H,g)&&(W=H);var z=A.prototype=b.prototype=Object.create(W);L.prototype=A,l(z,"constructor",{value:A,configurable:!0}),l(A,"constructor",{value:L,configurable:!0}),L.displayName=x(A,k,"GeneratorFunction");function K(r){["next","throw","return"].forEach(function(t){x(r,t,function(a){return this._invoke(t,a)})})}i.isGeneratorFunction=function(r){var t=typeof r=="function"&&r.constructor;return t?t===L||(t.displayName||t.name)==="GeneratorFunction":!1},i.mark=function(r){return Object.setPrototypeOf?Object.setPrototypeOf(r,A):(r.__proto__=A,x(r,k,"GeneratorFunction")),r.prototype=Object.create(z),r},i.awrap=function(r){return{__await:r}};function O(r,t){function a(N,T,B,U){var F=E(r[N],r,T);if(F.type==="throw")U(F.arg);else{var oe=F.arg,Q=oe.value;return Q&&typeof Q=="object"&&s.call(Q,"__await")?t.resolve(Q.__await).then(function(q){a("next",q,B,U)},function(q){a("throw",q,B,U)}):t.resolve(Q).then(function(q){oe.value=q,B(oe)},function(q){return a("throw",q,B,U)})}}var m;function f(N,T){function B(){return new t(function(U,F){a(N,T,U,F)})}return m=m?m.then(B,B):B()}l(this,"_invoke",{value:f})}K(O.prototype),x(O.prototype,S,function(){return this}),i.AsyncIterator=O,i.async=function(r,t,a,m,f){f===void 0&&(f=Promise);var N=new O(w(r,t,a,m),f);return i.isGeneratorFunction(t)?N:N.next().then(function(T){return T.done?T.value:N.next()})};function M(r,t,a){var m=j;return function(N,T){if(m===$)throw new Error("Generator is already running");if(m===d){if(N==="throw")throw T;return v()}for(a.method=N,a.arg=T;;){var B=a.delegate;if(B){var U=I(B,a);if(U){if(U===u)continue;return U}}if(a.method==="next")a.sent=a._sent=a.arg;else if(a.method==="throw"){if(m===j)throw m=d,a.arg;a.dispatchException(a.arg)}else a.method==="return"&&a.abrupt("return",a.arg);m=$;var F=E(r,t,a);if(F.type==="normal"){if(m=a.done?d:P,F.arg===u)continue;return{value:F.arg,done:a.done}}else F.type==="throw"&&(m=d,a.method="throw",a.arg=F.arg)}}}function I(r,t){var a=t.method,m=r.iterator[a];if(m===h)return t.delegate=null,a==="throw"&&r.iterator.return&&(t.method="return",t.arg=h,I(r,t),t.method==="throw")||a!=="return"&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+a+"' method")),u;var f=E(m,r.iterator,t.arg);if(f.type==="throw")return t.method="throw",t.arg=f.arg,t.delegate=null,u;var N=f.arg;if(!N)return t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u;if(N.done)t[r.resultName]=N.value,t.next=r.nextLoc,t.method!=="return"&&(t.method="next",t.arg=h);else return N;return t.delegate=null,u}K(z),x(z,k,"Generator"),x(z,g,function(){return this}),x(z,"toString",function(){return"[object Generator]"});function G(r){var t={tryLoc:r[0]};1 in r&&(t.catchLoc=r[1]),2 in r&&(t.finallyLoc=r[2],t.afterLoc=r[3]),this.tryEntries.push(t)}function C(r){var t=r.completion||{};t.type="normal",delete t.arg,r.completion=t}function D(r){this.tryEntries=[{tryLoc:"root"}],r.forEach(G,this),this.reset(!0)}i.keys=function(r){var t=Object(r),a=[];for(var m in t)a.push(m);return a.reverse(),function f(){for(;a.length;){var N=a.pop();if(N in t)return f.value=N,f.done=!1,f}return f.done=!0,f}};function y(r){if(r){var t=r[g];if(t)return t.call(r);if(typeof r.next=="function")return r;if(!isNaN(r.length)){var a=-1,m=function f(){for(;++a<r.length;)if(s.call(r,a))return f.value=r[a],f.done=!1,f;return f.value=h,f.done=!0,f};return m.next=m}}return{next:v}}i.values=y;function v(){return{value:h,done:!0}}return D.prototype={constructor:D,reset:function(r){if(this.prev=0,this.next=0,this.sent=this._sent=h,this.done=!1,this.delegate=null,this.method="next",this.arg=h,this.tryEntries.forEach(C),!r)for(var t in this)t.charAt(0)==="t"&&s.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=h)},stop:function(){this.done=!0;var r=this.tryEntries[0],t=r.completion;if(t.type==="throw")throw t.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var t=this;function a(U,F){return N.type="throw",N.arg=r,t.next=U,F&&(t.method="next",t.arg=h),!!F}for(var m=this.tryEntries.length-1;m>=0;--m){var f=this.tryEntries[m],N=f.completion;if(f.tryLoc==="root")return a("end");if(f.tryLoc<=this.prev){var T=s.call(f,"catchLoc"),B=s.call(f,"finallyLoc");if(T&&B){if(this.prev<f.catchLoc)return a(f.catchLoc,!0);if(this.prev<f.finallyLoc)return a(f.finallyLoc)}else if(T){if(this.prev<f.catchLoc)return a(f.catchLoc,!0)}else if(B){if(this.prev<f.finallyLoc)return a(f.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(r,t){for(var a=this.tryEntries.length-1;a>=0;--a){var m=this.tryEntries[a];if(m.tryLoc<=this.prev&&s.call(m,"finallyLoc")&&this.prev<m.finallyLoc){var f=m;break}}f&&(r==="break"||r==="continue")&&f.tryLoc<=t&&t<=f.finallyLoc&&(f=null);var N=f?f.completion:{};return N.type=r,N.arg=t,f?(this.method="next",this.next=f.finallyLoc,u):this.complete(N)},complete:function(r,t){if(r.type==="throw")throw r.arg;return r.type==="break"||r.type==="continue"?this.next=r.arg:r.type==="return"?(this.rval=this.arg=r.arg,this.method="return",this.next="end"):r.type==="normal"&&t&&(this.next=t),u},finish:function(r){for(var t=this.tryEntries.length-1;t>=0;--t){var a=this.tryEntries[t];if(a.finallyLoc===r)return this.complete(a.completion,a.afterLoc),C(a),u}},catch:function(r){for(var t=this.tryEntries.length-1;t>=0;--t){var a=this.tryEntries[t];if(a.tryLoc===r){var m=a.completion;if(m.type==="throw"){var f=m.arg;C(a)}return f}}throw new Error("illegal catch attempt")},delegateYield:function(r,t,a){return this.delegate={iterator:y(r),resultName:t,nextLoc:a},this.method==="next"&&(this.arg=h),u}},i}(c.exports);try{regeneratorRuntime=o}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=o:Function("r","regeneratorRuntime = r")(o)}})(Te);var ne=(c,o)=>`${c}-${o}-${Math.random().toString(16).slice(3,8)}`;const Ae=ne;let le=0;var fe=({id:c,action:o,payload:i={}})=>{let n=c;return typeof n>"u"&&(n=Ae("Job",le),le+=1),{id:n,action:o,payload:i}},Z={};let ce=!1;Z.logging=ce;Z.setLogging=c=>{ce=c};Z.log=(...c)=>ce?console.log.apply(void 0,c):null;const Me=fe,{log:ee}=Z,De=ne;let de=0;var Be=()=>{const c=De("Scheduler",de),o={},i={};let n=[];de+=1;const s=()=>n.length,l=()=>Object.keys(o).length,h=()=>{if(n.length!==0){const x=Object.keys(o);for(let w=0;w<x.length;w+=1)if(typeof i[x[w]]>"u"){n[0](o[x[w]]);break}}},p=(x,w)=>new Promise((E,j)=>{const P=Me({action:x,payload:w});n.push(async $=>{n.shift(),i[$.id]=P;try{E(await $[x].apply(void 0,[...w,P.id]))}catch(d){j(d)}finally{delete i[$.id],h()}}),ee(`[${c}]: Add ${P.id} to JobQueue`),ee(`[${c}]: JobQueue length=${n.length}`),h()});return{addWorker:x=>(o[x.id]=x,ee(`[${c}]: Add ${x.id}`),ee(`[${c}]: Number of workers=${l()}`),h(),x.id),addJob:async(x,...w)=>{if(l()===0)throw Error(`[${c}]: You need to have at least one worker before adding jobs`);return p(x,w)},terminate:async()=>{Object.keys(o).forEach(async x=>{await o[x].terminate()}),n=[]},getQueueLen:s,getNumWorkers:l}};function Fe(c){throw new Error('Could not dynamically require "'+c+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ze=c=>{const o={};return typeof WorkerGlobalScope<"u"?o.type="webworker":typeof document=="object"?o.type="browser":typeof process=="object"&&typeof Fe=="function"&&(o.type="node"),typeof c>"u"?o:o[c]};const Ue=ze("type")==="browser",Ge=Ue?c=>new URL(c,window.location.href).href:c=>c;var We=c=>{const o={...c};return["corePath","workerPath","langPath"].forEach(i=>{c[i]&&(o[i]=Ge(o[i]))}),o},me={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3};const He="6.0.1",Ye={version:He};var Ke={workerBlobURL:!0,logger:()=>{}};const qe=Ye.version,Je=Ke;var Ve={...Je,workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${qe}/dist/worker.min.js`},Ze=({workerPath:c,workerBlobURL:o})=>{let i;if(Blob&&URL&&o){const n=new Blob([`importScripts("${c}");`],{type:"application/javascript"});i=new Worker(URL.createObjectURL(n))}else i=new Worker(c);return i},Qe=c=>{c.terminate()},Xe=(c,o)=>{c.onmessage=({data:i})=>{o(i)}},et=async(c,o)=>{c.postMessage(o)};const ae=c=>new Promise((o,i)=>{const n=new FileReader;n.onload=()=>{o(n.result)},n.onerror=({target:{error:{code:s}}})=>{i(Error(`File could not be read! Code=${s}`))},n.readAsArrayBuffer(c)}),se=async c=>{let o=c;if(typeof c>"u")return"undefined";if(typeof c=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(c)?o=atob(c.split(",")[1]).split("").map(i=>i.charCodeAt(0)):o=await(await fetch(c)).arrayBuffer();else if(typeof HTMLElement<"u"&&c instanceof HTMLElement)c.tagName==="IMG"&&(o=await se(c.src)),c.tagName==="VIDEO"&&(o=await se(c.poster)),c.tagName==="CANVAS"&&await new Promise(i=>{c.toBlob(async n=>{o=await ae(n),i()})});else if(typeof OffscreenCanvas<"u"&&c instanceof OffscreenCanvas){const i=await c.convertToBlob();o=await ae(i)}else(c instanceof File||c instanceof Blob)&&(o=await ae(c));return new Uint8Array(o)};var tt=se;const rt=Ve,ot=Ze,at=Qe,st=Xe,nt=et,ct=tt;var it={defaultOptions:rt,spawnWorker:ot,terminateWorker:at,onMessage:st,send:nt,loadImage:ct};const lt=We,Y=fe,{log:ue}=Z,dt=ne,J=me,{defaultOptions:ut,spawnWorker:ht,terminateWorker:pt,onMessage:ft,loadImage:he,send:mt}=it;let pe=0;var ge=async(c="eng",o=J.LSTM_ONLY,i={},n={})=>{const s=dt("Worker",pe),{logger:l,errorHandler:h,...p}=lt({...ut,...i}),g={},S=typeof c=="string"?c.split("+"):c;let k=o,x=n;const w=[J.DEFAULT,J.LSTM_ONLY].includes(o)&&!p.legacyCore;let E,j;const P=new Promise((y,v)=>{j=y,E=v}),$=y=>{E(y.message)};let d=ht(p);d.onerror=$,pe+=1;const u=({id:y,action:v,payload:r})=>new Promise((t,a)=>{ue(`[${s}]: Start ${y}, action=${v}`);const m=`${v}-${y}`;g[m]={resolve:t,reject:a},mt(d,{workerId:s,jobId:y,action:v,payload:r})}),b=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),L=y=>u(Y({id:y,action:"load",payload:{options:{lstmOnly:w,corePath:p.corePath,logging:p.logging}}})),A=(y,v,r)=>u(Y({id:r,action:"FS",payload:{method:"writeFile",args:[y,v]}})),W=(y,v)=>u(Y({id:v,action:"FS",payload:{method:"readFile",args:[y,{encoding:"utf8"}]}})),R=(y,v)=>u(Y({id:v,action:"FS",payload:{method:"unlink",args:[y]}})),H=(y,v,r)=>u(Y({id:r,action:"FS",payload:{method:y,args:v}})),z=(y,v)=>u(Y({id:v,action:"loadLanguage",payload:{langs:y,options:{langPath:p.langPath,dataPath:p.dataPath,cachePath:p.cachePath,cacheMethod:p.cacheMethod,gzip:p.gzip,lstmOnly:[J.DEFAULT,J.LSTM_ONLY].includes(k)&&!p.legacyLang}}})),K=(y,v,r,t)=>u(Y({id:t,action:"initialize",payload:{langs:y,oem:v,config:r}})),O=(y="eng",v,r,t)=>{if(w&&[J.TESSERACT_ONLY,J.TESSERACT_LSTM_COMBINED].includes(v))throw Error("Legacy model requested but code missing.");const a=v||k;k=a;const m=r||x;x=m;const N=(typeof y=="string"?y.split("+"):y).filter(T=>!S.includes(T));return S.push(...N),N.length>0?z(N,t).then(()=>K(y,a,m,t)):K(y,a,m,t)},M=(y={},v)=>u(Y({id:v,action:"setParameters",payload:{params:y}})),I=async(y,v={},r={text:!0},t)=>u(Y({id:t,action:"recognize",payload:{image:await he(y),options:v,output:r}})),G=async(y,v)=>{if(w)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return u(Y({id:v,action:"detect",payload:{image:await he(y)}}))},C=async()=>(d!==null&&(pt(d),d=null),Promise.resolve());ft(d,({workerId:y,jobId:v,status:r,action:t,data:a})=>{const m=`${t}-${v}`;if(r==="resolve")ue(`[${y}]: Complete ${v}`),g[m].resolve({jobId:v,data:a}),delete g[m];else if(r==="reject")if(g[m].reject(a),delete g[m],t==="load"&&E(a),h)h(a);else throw Error(a);else r==="progress"&&l({...a,userJobId:v})});const D={id:s,worker:d,load:b,writeText:A,readText:W,removeFile:R,FS:H,reinitialize:O,setParameters:M,recognize:I,detect:G,terminate:C};return L().then(()=>z(c)).then(()=>K(c,o,n)).then(()=>j(D)).catch(()=>{}),P};const xe=ge,gt=async(c,o,i)=>{const n=await xe(o,1,i);return n.recognize(c).finally(async()=>{await n.terminate()})},xt=async(c,o)=>{const i=await xe("osd",0,o);return i.detect(c).finally(async()=>{await i.terminate()})};var yt={recognize:gt,detect:xt},bt={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"},vt={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"};const wt=Be,Nt=ge,jt=yt,St=bt,kt=me,Et=vt,{setLogging:Lt}=Z;var te={languages:St,OEM:kt,PSM:Et,createScheduler:wt,createWorker:Nt,setLogging:Lt,...jt};class Ct{constructor(){this.worker=null}async initWorker(){return this.worker||(this.worker=await te.createWorker("eng")),this.worker}async preprocessImage(o){return new Promise((i,n)=>{const s=new Image;s.onload=()=>{const l=document.createElement("canvas"),h=l.getContext("2d");if(!h){n(new Error("Failed to get canvas context"));return}l.width=s.width,l.height=s.height,h.filter="grayscale(100%) contrast(150%) brightness(120%)",h.drawImage(s,0,0),l.toBlob(p=>{p?i(p):n(new Error("Failed to preprocess image"))},"image/png")},s.onerror=()=>n(new Error("Failed to load image")),s.src=URL.createObjectURL(o)})}async extractCourseMetadata(o,i){try{const n=await this.initWorker(),s=await this.preprocessImage(o);await n.setParameters({tessedit_char_whitelist:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 ",tessedit_pageseg_mode:te.PSM.AUTO});const{data:l}=await n.recognize(s),h=l.text,p=l.confidence/100;let g="",S=0;if(i){const E=await this.preprocessImage(i),{data:j}=await n.recognize(E);g=j.text,S=j.confidence/100}const k=h+`
`+g,x=Math.min(p,S||1),w=this.parseCourseMetadata(k);return w.confidence=Math.min(w.confidence,x),w}catch(n){throw new Error(`Failed to extract course metadata: ${n instanceof Error?n.message:"Unknown error"}`)}}async detectScoresFilled(o){try{const i=await this.initWorker(),n=await this.preprocessImage(o);await i.setParameters({tessedit_char_whitelist:"0123456789",tessedit_pageseg_mode:te.PSM.SPARSE_TEXT});const{data:s}=await i.recognize(n),l=s.text,h=s.confidence/100,p=this.detectScorePatterns(l),g=this.extractScoreRegions(s.words);return{hasScores:p,confidence:h,detectedScoreRegions:g}}catch(i){throw new Error(`Failed to detect scores: ${i instanceof Error?i.message:"Unknown error"}`)}}async extractRoundData(o,i){try{const n=await this.initWorker(),s=await this.preprocessImage(o);await n.setParameters({tessedit_char_whitelist:"0123456789",tessedit_pageseg_mode:te.PSM.SINGLE_BLOCK});const{data:l}=await n.recognize(s),h=l.text,p=l.confidence/100;return this.parseScorecardText(h,l.words).map(k=>({...k,confidence:Math.min(k.confidence,p)}))}catch(n){throw new Error(`Failed to extract round data: ${n instanceof Error?n.message:"Unknown error"}`)}}parseCourseMetadata(o){const i=o.split(`
`).filter(S=>S.trim());let n="",s="";const l=[],h=[];let p=0,g=0;for(const S of i){const k=S.trim(),x=k.match(/^(?:course|club)[\s:]*([^\d]+?)(?:\s*\d|\s*$)/i);x&&!n&&(n=x[1].trim(),g+=.3);const w=k.match(/(?:location|city|state)[\s:]*(.+)/i);w&&!s&&(s=w[1].trim(),g+=.1);const E=k.match(/par[\s:]*(\d+)/i);if(E){const P=parseInt(E[1]);P>=3&&P<=5&&(l.push(P),g+=.2)}const j=k.match(/hole[\s:]*(\d+)[\s,]*par[\s:]*(\d+)(?:\s*,?\s*distance[\s:]*(\d+))?(?:\s*,?\s*handicap[\s:]*(\d+))?/i);if(j){const P=parseInt(j[1]),$=parseInt(j[2]),d=j[3]?parseInt(j[3]):void 0,u=j[4]?parseInt(j[4]):void 0;P>=1&&P<=18&&$>=3&&$<=5&&(h.push({holeNumber:P,par:$,distance:d,handicap:u}),g+=.4)}}return p=l.reduce((S,k)=>S+k,0),n||(n="Unknown Course",g-=.3),h.length===0&&l.length>0&&h.push(...l.map((S,k)=>({holeNumber:k+1,par:S}))),g=Math.max(0,Math.min(1,g)),{courseName:n,location:s,parRatings:l,holeDetails:h,totalPar:p,confidence:g}}detectScorePatterns(o){const i=o.split(`
`);let n=0;for(const s of i){const l=s.match(/\d+/g);if(l&&l.length>=2){const h=l.map(p=>parseInt(p));h.some(p=>p>=1&&p<=18)&&h.some(p=>p>=1&&p<=10)&&n++}}return n>=3}extractScoreRegions(o){const i=[];for(const n of o)n.text.match(/^\d+$/)&&parseInt(n.text)>=1&&parseInt(n.text)<=18&&i.push({holeNumber:parseInt(n.text),boundingBox:n.bbox});return i}parseScorecardText(o,i){const n=o.split(`
`).filter(l=>l.trim()),s=[];for(const l of n){const p=l.trim().match(/(?:hole\s*)?(\d+)\s*:?\s*(\d+)/i);if(p){const g=parseInt(p[1]),S=parseInt(p[2]);g>=1&&g<=18&&S>=1&&S<=15&&(this.findBoundingBoxForHole(i,g),s.push({holeNumber:g,score:S,confidence:.8}))}}return s}findBoundingBoxForHole(o,i){const n=o.find(s=>s.text===i.toString());return n?n.bbox:void 0}convertToCourse(o){var n,s,l,h;const i=o.holeDetails.map(p=>({number:p.holeNumber,par:p.par,handicap:p.handicap||1,yardages:p.distance?{regular:p.distance}:{}}));return{id:`course-${Date.now()}`,name:o.courseName,location:{address:o.location,city:(s=(n=o.location)==null?void 0:n.split(",")[0])==null?void 0:s.trim(),state:(h=(l=o.location)==null?void 0:l.split(",")[1])==null?void 0:h.trim()},holes:i,par:o.totalPar,confidence:o.confidence}}convertToRound(o,i){const n=o.filter(l=>l.score!==null).map(l=>({holeNumber:l.holeNumber,score:l.score,putts:l.putts||void 0,fairwayHit:void 0,greenInRegulation:void 0,penaltyStrokes:0})),s=o.reduce((l,h)=>l+h.confidence,0)/o.length;return{courseId:i,date:new Date().toISOString().split("T")[0],teeBox:"Regular",holeScores:n,confidence:s}}async cleanup(){this.worker&&(await this.worker.terminate(),this.worker=null)}}const Pt=({db:c,onSave:o,onCancel:i,onStartNewRound:n})=>{const[s,l]=_.useState("capture"),[h,p]=_.useState(null),[g,S]=_.useState(null),[k,x]=_.useState(null),[w,E]=_.useState([]),[j,P]=_.useState(!1),[$,d]=_.useState(null),[u,b]=_.useState(null),[L,A]=_.useState(null),W=_.useCallback(async(O,M)=>{p(O),S(M),l("processing"),d(null),P(!0);try{const I=new Ct,G=await I.extractCourseMetadata(O,M);x(G);const C=new Blob([O],{type:O.type});if((await I.detectScoresFilled(C)).hasScores){const y=await I.extractRoundData(C,G);E(y)}else E([]);await I.cleanup(),l("review")}catch(I){console.error("Processing error:",I),d(I instanceof Error?I.message:"Failed to process scorecard"),l("capture")}finally{P(!1)}},[]),R=_.useCallback(async(O,M)=>{try{if(await c.put("courses",O),b(O),M){const I=`round-${Date.now()}`,G={id:I,courseId:M.courseId,date:M.date,teeBox:M.teeBox,totalScore:M.holeScores.reduce((C,D)=>C+D.score,0),scoreToPar:M.holeScores.reduce((C,D)=>C+D.score,0)-O.par,differential:M.holeScores.reduce((C,D)=>C+D.score,0)-O.par,completed:!0};await c.put("rounds",G);for(const C of M.holeScores){const D={id:`hole-${I}-${C.holeNumber}`,roundId:I,holeNumber:C.holeNumber,score:C.score,putts:C.putts||0,fairwayHit:C.fairwayHit||"n/a",greenInRegulation:C.greenInRegulation||!1,penaltyStrokes:C.penaltyStrokes||0};await c.put("holeScores",D)}A(G)}l("post-save")}catch(I){console.error("Save error:",I);const G=I instanceof Error?I.message:"Failed to save data to database";d(G),l("review")}},[c]),H=_.useCallback(()=>{u&&n&&n(u)},[u,n]),z=_.useCallback(()=>{l("capture"),p(null),S(null),x(null),E([]),d(null),b(null),A(null)},[]),K=()=>{switch(s){case"capture":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 rounded-lg","aria-label":"Go back",children:e.jsx(ie,{size:24})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Import Scorecard"})]}),e.jsx($e,{onProceed:W}),$&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800",children:$})})]});case"processing":return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] space-y-6",children:[e.jsx(Re,{size:48,className:"animate-spin text-blue-600"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Processing Scorecard"}),e.jsx("p",{className:"text-gray-600",children:"Extracting course information and scores..."})]})]});case"review":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>l("capture"),className:"p-2 hover:bg-gray-100 rounded-lg","aria-label":"Go back to photo capture",children:e.jsx(ie,{size:24})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Review Extracted Data"})]}),e.jsx(Oe,{extractedCourseMetadata:k,extractedRoundData:w,onSave:R,onCancel:()=>l("capture")})]});case"post-save":return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] space-y-6",children:[e.jsx(Le,{size:64,className:"text-green-600"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Import Complete!"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:['Course "',u==null?void 0:u.name,'" has been saved successfully.',L&&" Round data has also been saved."]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-4 w-full max-w-md",children:L?e.jsxs("button",{onClick:z,className:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center justify-center gap-2",children:[e.jsx(re,{size:20}),"Import Another"]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:H,className:"flex-1 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center justify-center gap-2",children:[e.jsx(_e,{size:20}),"Start Round"]}),e.jsxs("button",{onClick:z,className:"flex-1 px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center justify-center gap-2",children:[e.jsx(re,{size:20}),"Import Another"]})]})})]});default:return null}};return e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:K()})};export{Pt as default};
